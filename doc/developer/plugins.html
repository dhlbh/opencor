<!DOCTYPE html>
<html>
    <head>
        <title>
            Plugins
        </title>

        <meta http-equiv="content-type" content="text/html; charset=iso-8859-1" />

        <link href="res/stylesheet.css" rel="stylesheet" type="text/css" />

        <link href="../3rdparty/googleCodePrettify/prettify.css" rel="stylesheet" type="text/css" />
        <script type="text/javascript" src="../3rdparty/googleCodePrettify/prettify.js"></script>
    </head>
    <body onload="prettyPrint()">
        <h1>
            Plugins
        </h1>

        <h2>
            General
        </h2>

        <p>
            OpenCOR is an application which completely relies on <a href="https://github.com/opencor/opencor/tree/master/src/plugins"><code>plugins</code></a>. So, though OpenCOR works if no plugin is loaded, it is of no use at all.
        </p>

        <p>
             Some of the plugins provide access to <a href="https://github.com/opencor/opencor/tree/master/src/plugins/3rdparty">third-party libraries</a> while others are specific to the <a href="https://github.com/opencor/opencor/tree/master/src/plugins/organise">organisation</a> or <a href="https://github.com/opencor/opencor/tree/master/src/plugins/edit">editing</a> side of OpenCOR, or are <a href="https://github.com/opencor/opencor/tree/master/src/plugins/misc">plugins</a> that do not fit in any of the aforementioned categories.
        </p>

        <h2>
            Deployment
        </h2>

        <p>
            Our CMake <a href="https://github.com/opencor/opencor/blob/master/cmake/common.cmake"><code>ADD_PLUGIN</code></a> macro takes care of the deployment of a plugin. However, on Mac OS X, we must ensure that all the Qt libraries required by the plugins are embedded within the OpenCOR bundle and, more precisely, within <code>[OpenCOR.app]/Contents/Frameworks</code>. Indeed, <code>macdeployqt</code> can only deploy the libraries required by OpenCOR itself, not its plugins. So, it is up to us to determine which libraries are required and to deploy them:
        </p>

        <ul>
            <li>
                <strong>Qt dependencies:</strong> our shell script, <a href="res/qtdependencies">qtdependencies</a>, can be used to check which libraries are required by one or several Qt binaries. Thus, to check which Qt libraries are required by OpenCOR's plugins, we could enter the following on the command line, this after having built OpenCOR:
                <pre>$ cd [OpenCOR]
$ doc/developer/res/qtdependencies build/OpenCOR.app/Contents/PlugIns
QtCore
QtDBus
QtDeclarative
QtGui
QtHelp
QtNetwork
QtOpenGL
QtScript
QtSql
QtSvg
QtWebKit
QtXml
QtXmlPatterns
phonon</pre>
                From there, we can compare the above list against the list of Qt libraries that got deployed to <code>[OpenCOR.app]/Contents/Frameworks</code> by <code>macdeployqt</code>, and see which ones are missing.
            </li>
            <li>
                <strong>Qt libraries deployment:</strong> any missing Qt library can be deployed using our CMake <a href="https://github.com/opencor/opencor/blob/master/cmake/common.cmake"><code>DEPLOY_MAC_OS_X_QT_LIBRARY</code></a> macro, but first we must determine the library's Qt dependencies. For example, for <code>QtHelp</code>, we could enter the following on the command line
                <pre>$ [OpenCOR]/doc/developer/res/qtdependencies /Library/Frameworks/QtHelp.framework/Versions/4/QtHelp
QtCore
QtGui
QtHelp
QtNetwork
QtSql
QtXml
</pre>
                The <code>QtHelp</code> dependency can be ignored, leaving us with the following call to <a href="https://github.com/opencor/opencor/blob/master/cmake/common.cmake"><code>DEPLOY_MAC_OS_X_QT_LIBRARY</code></a> which is also used in <a href="https://github.com/opencor/opencor/blob/master/CMakeLists.txt"><code>[OpenCOR]/CMakeLists.txt</code></a>:
                <pre>DEPLOY_MAC_OS_X_QT_LIBRARY(QtHelp
    QtCore
    QtGui
    QtNetwork
    QtSql
    QtXml
)
</pre>
                This will embed <code>QtHelp</code> within the OpenCOR bundle, after having stripped it from anything that is not essential (thus reducing its size) and having ensured that its Qt dependencies (<code>QtCore</code>, <code>QtGui</code>, <code>QtNetwork</code>, <code>QtSql</code> and <code>QtXml</code>) refer to our embedded version of the Qt libraries.
            </li>
        </ul>

        <div class="copyright">
            Copyright ©2011
        </div>
    </body>
</html>
